/******************************************************************************/
/***         Generated by IBExpert 2020.4.21.2 29/11/2022 23:08:04          ***/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES WIN1252;

CREATE DATABASE 'C:\CrisProject\Fortes\Database\RETAG_BASE.FDB'
USER 'SYSDBA' PASSWORD 'Xexa4ace@'
PAGE_SIZE 16384
DEFAULT CHARACTER SET WIN1252 COLLATION WIN1252;



/******************************************************************************/
/***                                Domains                                 ***/
/******************************************************************************/

CREATE DOMAIN D_DATE AS
DATE;

CREATE DOMAIN D_TIME AS
TIME;



/******************************************************************************/
/***                               Generators                               ***/
/******************************************************************************/

CREATE GENERATOR GEN_CAD_BOMBAS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_CAD_BOMBAS_ID TO 0;

CREATE GENERATOR GEN_CAD_PRODUTO_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_CAD_PRODUTO_ID TO 0;

CREATE GENERATOR GEN_CAD_USUARIOS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_CAD_USUARIOS_ID TO 0;

CREATE GENERATOR GEN_VENDAS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_VENDAS_ID TO 0;



/******************************************************************************/
/***                                 Tables                                 ***/
/******************************************************************************/



CREATE TABLE CAD_BOMBAS (
    ID_BOMBA    INTEGER NOT NULL,
    DESCRICAO   VARCHAR(100),
    ID_PRODUTO  INTEGER
);

CREATE TABLE CAD_PRODUTO (
    ID_PRODUTO         INTEGER NOT NULL,
    DESCRICAO          VARCHAR(100),
    PRECOVENDA         NUMERIC(15,2),
    PERCENTUALIMPOSTO  NUMERIC(15,2)
);

CREATE TABLE CAD_USUARIOS (
    ID_USUARIO       INTEGER NOT NULL,
    NOME             VARCHAR(100) DEFAULT NULL,
    SENHA            VARCHAR(30) DEFAULT NULL,
    CONFIRMASENHA    VARCHAR(30) DEFAULT NULL,
    EMAIL            VARCHAR(100) DEFAULT NULL,
    USUARIOINCLUSAO  INTEGER,
    DATAINCLUSAO     D_DATE,
    HORAINCLUSAO     D_TIME
);

CREATE TABLE VENDAS (
    ID_VENDA           INTEGER NOT NULL,
    ID_BOMBA           INTEGER,
    QTD                NUMERIC(15,2),
    PRECOVENDA         NUMERIC(15,2),
    PERCENTUALIMPOSTO  NUMERIC(15,2),
    TOTALVENDA         NUMERIC(15,2),
    DATAVENDA          D_DATE,
    HORAVENDA          D_TIME
);

INSERT INTO CAD_PRODUTO (ID_PRODUTO, DESCRICAO, PRECOVENDA, PERCENTUALIMPOSTO) VALUES (1, 'GASOLINA GRANEL', 4, 13);
INSERT INTO CAD_PRODUTO (ID_PRODUTO, DESCRICAO, PRECOVENDA, PERCENTUALIMPOSTO) VALUES (2, 'OLEO DIESEL', 3, 13);

COMMIT WORK;

INSERT INTO CAD_BOMBAS (ID_BOMBA, DESCRICAO, ID_PRODUTO) VALUES (1, 'BOMBA 1', 1);
INSERT INTO CAD_BOMBAS (ID_BOMBA, DESCRICAO, ID_PRODUTO) VALUES (2, 'BOMBA 2', 1);
INSERT INTO CAD_BOMBAS (ID_BOMBA, DESCRICAO, ID_PRODUTO) VALUES (3, 'BOMBA 3', 2);
INSERT INTO CAD_BOMBAS (ID_BOMBA, DESCRICAO, ID_PRODUTO) VALUES (4, 'BOMBA 4', 2);

COMMIT WORK;

INSERT INTO CAD_USUARIOS (ID_USUARIO, NOME, SENHA, CONFIRMASENHA, EMAIL, USUARIOINCLUSAO, DATAINCLUSAO, HORAINCLUSAO) VALUES (1, 'adminC', 'admin1', NULL, 'massini.cristhian@gmail.com', NULL, NULL, NULL);

COMMIT WORK;

INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (1, 4, 30, 3, 13, 101.7, '2022-11-29', '03:40:34');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (2, 3, 15, 3, 13, 50.85, '2022-11-29', '03:45:12');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (3, 2, 10, 4, 13, 45.2, '2022-11-29', '03:50:14');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (4, 1, 12, 4, 13, 54.24, '2022-11-29', '03:55:53');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (5, 1, 15, 4, 13, 67.8, '2022-11-29', '04:00:32');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (6, 2, 5, 4, 13, 22.6, '2022-11-29', '04:05:56');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (7, 3, 100, 3, 13, 339, '2022-11-29', '04:10:01');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (8, 4, 200, 3, 13, 678, '2022-11-29', '04:15:03');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (9, 3, 1000, 3, 13, 3390, '2022-11-29', '04:20:34');
INSERT INTO VENDAS (ID_VENDA, ID_BOMBA, QTD, PRECOVENDA, PERCENTUALIMPOSTO, TOTALVENDA, DATAVENDA, HORAVENDA) VALUES (10, 2, 40, 4, 13, 180.8, '2022-11-29', '04:25:57');

COMMIT WORK;



/******************************************************************************/
/***                              Primary keys                              ***/
/******************************************************************************/

ALTER TABLE CAD_BOMBAS ADD CONSTRAINT PK_CAD_BOMBAS PRIMARY KEY (ID_BOMBA);
ALTER TABLE CAD_PRODUTO ADD CONSTRAINT PK_CAD_PRODUTO PRIMARY KEY (ID_PRODUTO);
ALTER TABLE CAD_USUARIOS ADD CONSTRAINT PK_CAD_USUARIOS PRIMARY KEY (ID_USUARIO);
ALTER TABLE VENDAS ADD CONSTRAINT PK_VENDAS PRIMARY KEY (ID_VENDA);


/******************************************************************************/
/***                              Foreign keys                              ***/
/******************************************************************************/

ALTER TABLE CAD_BOMBAS ADD CONSTRAINT FK_CAD_BOMBAS_1 FOREIGN KEY (ID_PRODUTO) REFERENCES CAD_PRODUTO (ID_PRODUTO);


/******************************************************************************/
/***                                Triggers                                ***/
/******************************************************************************/



SET TERM ^ ;



/******************************************************************************/
/***                          Triggers for tables                           ***/
/******************************************************************************/



/* Trigger: CAD_BOMBAS_BI */
CREATE TRIGGER CAD_BOMBAS_BI FOR CAD_BOMBAS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_bomba is null) then
    new.id_bomba = gen_id(gen_cad_bombas_id,1);
end
^

/* Trigger: CAD_PRODUTO_BI */
CREATE TRIGGER CAD_PRODUTO_BI FOR CAD_PRODUTO
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_produto is null) then
    new.id_produto = gen_id(gen_cad_produto_id,1);
end
^

/* Trigger: CAD_USUARIOS_BI */
CREATE TRIGGER CAD_USUARIOS_BI FOR CAD_USUARIOS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_usuario is null) then
    new.id_usuario = gen_id(gen_cad_usuarios_id,1);
end
^

/* Trigger: VENDAS_BI */
CREATE TRIGGER VENDAS_BI FOR VENDAS
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id_venda is null) then
    new.id_venda = gen_id(gen_vendas_id,1);
end
^
SET TERM ; ^

